<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>iBandbyte — Artists</title>
  <style>
    :root{
      --yellow:#FFB100;           /* byte */
      --purple:#6a11cb;           /* gradient start */
      --orange:#ff6600;           /* gradient end   */
      --bg:#0f0f12;               /* stage dark     */
      --panel:#17181d;
      --text:#f7f8fb;
      --muted:#bdc3cf;
      --ring:rgba(255,177,0,.45);
      --border:#23242a;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
    a{color:inherit}

    /* ===== Sticky Header ===== */
    .wrap{position:sticky;top:0;z-index:50;backdrop-filter:saturate(120%) blur(6px);background:linear-gradient(180deg,rgba(15,15,18,.92),rgba(15,15,18,.6) 70%,transparent)}
    header{padding:16px 16px 10px;text-align:center;border-bottom:1px solid #00000033}
    h1{margin:0;font-size:clamp(26px,4.5vw,36px);letter-spacing:.2px}
    .brand .iband{color:#fff}
    .brand .byte{color:var(--yellow)}

    .toolbar{
      display:flex;gap:10px;justify-content:center;align-items:center;
      padding:12px 16px 16px;flex-wrap:wrap
    }
    .search{
      width:min(620px,92vw);padding:12px 14px;border-radius:12px;border:1px solid var(--border);
      background:#131419;color:#fff;outline:none;transition:box-shadow .2s,border-color .2s
    }
    .search:focus{border-color:#2e2f37;box-shadow:0 0 0 5px rgba(255,255,255,.04)}
    .btn{
      padding:12px 16px;border:0;border-radius:12px;color:#fff;cursor:pointer;font-weight:800;
      background:linear-gradient(90deg,var(--purple),var(--orange));
      box-shadow:0 6px 18px rgba(0,0,0,.35);transition:transform .15s,box-shadow .15s,opacity .15s
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 12px 26px var(--ring)}
    .btn.secondary{background:#1b1c22;border:1px solid var(--border);font-weight:700}

    main{max-width:1100px;margin:14px auto 64px;padding:0 16px}

    /* ===== Grid ===== */
    .grid{
      display:grid;gap:14px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    @media (min-width:720px){
      .grid{grid-template-columns: repeat(3, minmax(0,1fr));}
    }
    @media (min-width:980px){
      .grid{grid-template-columns: repeat(4, minmax(0,1fr));}
    }

    .card{
      background:linear-gradient(145deg,var(--purple),var(--orange));
      border-radius:16px;padding:14px;color:#fff;box-shadow:0 8px 22px rgba(0,0,0,.45);
      display:flex;gap:12px;align-items:center;min-height:82px;
      transition:transform .12s,box-shadow .12s
    }
    .card:hover{transform:translateY(-3px);box-shadow:0 14px 30px var(--ring)}
    .avatar{
      flex:0 0 44px;height:44px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #ffdca8, #ff8a4d, #b14ae0 70%);
      display:grid;place-items:center;font-weight:900;color:#111;text-shadow:0 1px 0 rgba(255,255,255,.35)
    }
    .title{font-size:1.05rem;font-weight:900;line-height:1.05}
    .genre{color:#ffe;opacity:.95;margin-top:3px;font-size:.95rem}

    .empty{
      padding:30px;text-align:center;background:#131419;border:1px dashed var(--border);
      border-radius:14px;color:var(--muted)
    }

    /* ===== Pagination ===== */
    .pagination{display:flex;gap:8px;justify-content:center;align-items:center;margin:20px 0 8px}
    .page-btn{
      min-width:42px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#131419;color:#fff;
      cursor:pointer;transition:transform .1s,background .1s,opacity .1s
    }
    .page-btn.active{background:linear-gradient(90deg,var(--purple),var(--orange));border-color:transparent}
    .page-btn:disabled{opacity:.45;cursor:not-allowed}

    /* ===== Debug ===== */
    details.debug{max-width:1100px;margin:22px auto;padding:0 16px}
    details.debug summary{
      background:#14151b;border:1px solid var(--border);border-radius:12px;padding:12px 14px;cursor:pointer;list-style:none;font-weight:800
    }
    details.debug pre{margin:0;background:#0f1015;border:1px solid var(--border);border-top:0;padding:16px;border-radius:0 0 12px 12px;overflow:auto}

    footer{color:#a9b0bd;text-align:center;padding:28px 0 42px;font-size:.95rem}

    /* ===== Loading shimmer ===== */
    .skeleton{
      border-radius:16px;min-height:82px;background:#1b1c22;position:relative;overflow:hidden
    }
    .skeleton:after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
      transform:translateX(-100%);animation:shimmer 1.2s infinite
    }
    @keyframes shimmer{100%{transform:translateX(100%)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 class="brand"><span class="iband">iBand</span><span class="byte">byte</span> Artists</h1>
    </header>

    <div class="toolbar">
      <input id="search" class="search" type="text" placeholder="Search artists…" />
      <button class="btn" id="refreshBtn">Refresh</button>
      <button class="btn secondary" id="clearBtn">Clear</button>
    </div>
  </div>

  <main>
    <div id="list" class="grid" aria-live="polite"></div>

    <div class="pagination" id="pager" hidden>
      <button class="page-btn" id="prevBtn">‹</button>
      <span id="pages"></span>
      <button class="page-btn" id="nextBtn">›</button>
    </div>

    <details class="debug">
      <summary>Debug Panel</summary>
      <pre id="debug">Waiting…</pre>
    </details>
  </main>

  <footer>
    © 2025 <strong class="brand"><span class="iband">iBand</span><span class="byte">byte</span></strong>. All rights reserved.
  </footer>

  <script>
    // ====== CONFIG ======
    const API_URL = "https://iband-backend-first-2.onrender.com/artists";
    const PAGE_SIZE = 12; // ⬅️ mega version shows 12 per page

    // ====== STATE ======
    let fullData = [];
    let filtered = [];
    let page = 1;

    // ====== DOM ======
    const $list   = document.getElementById("list");
    const $debug  = document.getElementById("debug");
    const $search = document.getElementById("search");
    const $refresh= document.getElementById("refreshBtn");
    const $clear  = document.getElementById("clearBtn");
    const $pager  = document.getElementById("pager");
    const $pages  = document.getElementById("pages");
    const $prev   = document.getElementById("prevBtn");
    const $next   = document.getElementById("nextBtn");

    // ====== HELPERS ======
    const avatar = name => (name?.trim?.()[0] || "?").toUpperCase();

    function setDebug(obj){
      try{$debug.textContent = JSON.stringify(obj, null, 2);}
      catch{ $debug.textContent = String(obj); }
    }

    function setLoading(is){
      if(is){
        $list.innerHTML = "";
        for(let i=0;i<8;i++){
          const sk = document.createElement("div");
          sk.className = "skeleton";
          $list.appendChild(sk);
        }
        $pager.hidden = true;
      }
    }

    function render(){
      $list.innerHTML = "";

      if(!filtered.length){
        $list.innerHTML = '<div class="empty">No artists found.</div>';
        $pager.hidden = true;
        return;
      }

      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      if(page > totalPages) page = totalPages;
      const start = (page - 1) * PAGE_SIZE;
      const slice = filtered.slice(start, start + PAGE_SIZE);

      for(const a of slice){
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="avatar">${avatar(a.name)}</div>
          <div>
            <div class="title">${a.name || "Unnamed artist"}</div>
            <div class="genre">${a.genre || "No genre set"}</div>
          </div>`;
        $list.appendChild(card);
      }

      renderPager(totalPages);
    }

    function renderPager(totalPages){
      $pages.innerHTML = "";
      $pager.hidden = totalPages <= 1;

      const makeBtn = (label, active=false, disabled=false, onClick=null) => {
        const b = document.createElement("button");
        b.className = "page-btn" + (active ? " active": "");
        b.textContent = label;
        if(disabled) b.disabled = true;
        if(onClick) b.onclick = onClick;
        return b;
      };

      $prev.disabled = (page <= 1);
      $next.disabled = (page >= totalPages);
      $prev.onclick  = () => { if(page>1){ page--; render(); window.scrollTo({top:0,behavior:"smooth"});} };
      $next.onclick  = () => { if(page<totalPages){ page++; render(); window.scrollTo({top:0,behavior:"smooth"});} };

      // show up to 7 page buttons around the current page
      const max = 7;
      let from = Math.max(1, page - 3);
      let to   = Math.min(totalPages, from + max - 1);
      from     = Math.max(1, to - max + 1);

      for(let i=from; i<=to; i++){
        $pages.appendChild(makeBtn(String(i), i===page, false, () => { page = i; render(); window.scrollTo({top:0,behavior:"smooth"});} ));
      }
    }

    function applyFilter(){
      const q = $search.value.trim().toLowerCase();
      filtered = !q ? fullData.slice() :
        fullData.filter(a =>
          (a.name || "").toLowerCase().includes(q) ||
          (a.genre || "").toLowerCase().includes(q)
        );
      page = 1;
      render();
    }

    // ====== FETCH ======
    async function fetchArtists(){
      try{
        setLoading(true);
        const res = await fetch(API_URL, { cache: "no-store" });
        const data = await res.json();

        // normalize & sort
        fullData = Array.isArray(data) ? data.map(a => ({
          name:  a?.name  ?? "",
          genre: a?.genre ?? "No genre set",
        })) : [];

        fullData.sort((a,b)=> a.name.localeCompare(b.name));

        setDebug({ status: res.status, count: fullData.length, sample: fullData.slice(0,8) });

        filtered = fullData.slice();
        page = 1;
        render();
      }catch(err){
        setDebug({ error: err?.message || String(err) });
        $list.innerHTML = `<div class="empty">Error: ${err?.message || err}</div>`;
        $pager.hidden = true;
      }
    }

    // ====== WIRE UP ======
    let debounce;
    $search.addEventListener("input", () => {
      clearTimeout(debounce);
      debounce = setTimeout(applyFilter, 150);
    });
    $refresh.addEventListener("click", fetchArtists);
    $clear.addEventListener("click", () => { $search.value = ""; applyFilter(); });

    // First load
    fetchArtists();
  </script>
</body>
</html>